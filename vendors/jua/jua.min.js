/* RainLoop Webmail (c) RainLoop Team | MIT */
!function(){function e(e){function n(){if(o&&a<e){var t=o,r=t[0],u=Array.prototype.slice.call(t,1),d=t.index;o=o===i?i=null:o.next,++a,u.push(function(e,t){--a,s||(e?l&&c(s=e,l=p=o=i=null):(p[d]=t,--l?n():c(null,p)))}),r.apply(null,u)}}var o,i,r={},a=0,l=0,u=-1,s=null,p=[],c=t;return arguments.length<1&&(e=1/0),r.defer=function(){if(!s){var e=arguments;e.index=++u,i?(i.next=e,i=i.next):o=i=e,++l,n()}return r},r.await=function(e){return c=e,l||c(s,p),r},r}function t(){}"undefined"==typeof module?self.queue=e:module.exports=e,e.version="0.0.2"}(),function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){!function(){"use strict";n(1).Jua=n(7)}()},function(e,t,n){e.exports=window},function(e,t,n){!function(){"use strict";var t={iDefLimit:20};e.exports=t}()},function(e,t,n){e.exports=jQuery},function(e,t,n){!function(){"use strict";var t={},o=n(1),i=n(3),r=n(2);t.isUndefined=function(e){return void 0===e},t.extend=function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},t.contains=function(e,t){var n=!1;return e&&t&&(n=e===t||(e.contains?e.contains(t):!!t.compareDocumentPosition&&!!(8&t.compareDocumentPosition(e)))),n},t.mainClearTimeout=function(e){0<e&&clearTimeout(e),e=0},t.getEvent=function(e){return(e=e&&(e.originalEvent?e.originalEvent:e)||o.event).dataTransfer?e:null},t.getValue=function(e,n,o){return e&&n&&!t.isUndefined(e[n])?e[n]:o},t.setValue=function(e,t,n){e[t]=n},t.isNonEmptyArray=function(e){return!!(e&&e.length&&0<e.length)},t.pInt=function(e){return parseInt(e||0,10)},t.scopeBind=function(e,n){return function(){return e.apply(t.isUndefined(n)?null:n,Array.prototype.slice.call(arguments))}},t.fakeMd5=function(e){var n="",i="0123456789abcdefghijklmnopqrstuvwxyz";for(e=t.isUndefined(e)?32:t.pInt(e);n.length<e;)n+=i.substr(o.Math.round(o.Math.random()*i.length),1);return n},t.getNewUid=function(){return"jua-uid-"+t.fakeMd5(16)+"-"+(new o.Date).getTime().toString()},t.getDataFromFile=function(e){var n=t.isUndefined(e.fileName)?t.isUndefined(e.name)?null:e.name:e.fileName,o=t.isUndefined(e.fileSize)?t.isUndefined(e.size)?null:e.size:e.fileSize,i=t.isUndefined(e.type)?null:e.type;return"/"===n.charAt(0)&&(n=n.substr(1)),""===i&&0===o?null:{FileName:n,Size:o,Type:i,Folder:"",File:e}},t.getDataFromFiles=function(e,n,o,i){var a,l,u=0,s=0,p=null,c=null,d=!1;if(a=o=t.isUndefined(o)?r.iDefLimit:t.pInt(o),l=0<o,e=e&&0<e.length?e:null)for(s=0,u=e.length;s<u;s++)(p=e[s])&&(!l||0<=--o?(c=t.getDataFromFile(p))&&n(c):l&&!d&&0>o&&i&&(d=!0,i(a)))},t.getDataFromInput=function(e,n,o,i){var r=e&&e.files&&0<e.files.length?e.files:null;r?t.getDataFromFiles(r,n,o,i):n({FileName:e.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})},t.eventContainsFiles=function(e){var t=!1;if(e&&e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.length)for(var n=0,o=e.dataTransfer.types.length;n<o;n++)if("files"===e.dataTransfer.types[n].toLowerCase()){t=!0;break}return t},t.getDataFromDragEvent=function(e,n,o,i){var r=null;(e=t.getEvent(e))&&t.eventContainsFiles(e)&&(r=t.getValue(e,"files",null)||(e.dataTransfer?t.getValue(e.dataTransfer,"files",null):null))&&0<r.length&&t.getDataFromFiles(r,n,o,i)},t.createNextLabel=function(){return i('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})},t.createNextInput=function(){return i('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; left: -9999px;" />')},t.getNewInput=function(e,n){e=t.isUndefined(e)?"":e.toString();var o=t.createNextInput();return 0<e.length&&o.attr("name",e),(t.isUndefined(n)||n)&&o.prop("multiple",!0),o},t.getStringOrCallFunction=function(e,t){return i.isFunction(e)?e.apply(null,i.isArray(t)?t:[]).toString():e.toString()},e.exports=t}()},function(e,t,n){!function(){"use strict";var t=n(3),o=n(2),i=n(4);function r(e,t){this.oXhrs={},this.oUids={},this.oJua=e,this.oOptions=t}r.prototype.oXhrs={},r.prototype.oUids={},r.prototype.oJua=null,r.prototype.oOptions={},r.prototype.isDragAndDropSupported=function(){return!0},r.prototype.regTaskUid=function(e){this.oUids[e]=!0},r.prototype.uploadTask=function(e,n,o){if(!1===this.oUids[e]||!n||!n.File)return o(null,e),!1;try{var r=this,a=new XMLHttpRequest,l=new FormData,u=i.getValue(this.oOptions,"action",""),s=i.getValue(this.oOptions,"hidden",{}),p=this.oJua.getEvent("onStart"),c=this.oJua.getEvent("onComplete"),d=this.oJua.getEvent("onProgress");return a.open("POST",u,!0),d&&a.upload&&(a.upload.onprogress=function(t){t&&t.lengthComputable&&!i.isUndefined(t.loaded)&&!i.isUndefined(t.total)&&d(e,t.loaded,t.total)}),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){if(c){var n=!1,l=null;try{l=t.parseJSON(a.responseText),n=!0}catch(e){l=null}c(e,n,l)}i.isUndefined(r.oXhrs[e])||(r.oXhrs[e]=null),o(null,e)}else 4===a.readyState&&(c(e,!1,null),o(null,e))},p&&p(e),l.append("jua-post-type","ajax"),l.append(i.getValue(this.oOptions,"name","juaFile"),n.File),t.each(s,function(e,t){l.append(e,i.getStringOrCallFunction(t,[n]))}),a.send(l),this.oXhrs[e]=a,!0}catch(e){}return o(null,e),!1},r.prototype.generateNewInput=function(e){var n=this,r=null,a=null;e&&(a=i.getNewInput("",!i.getValue(this.oOptions,"disableMultiple",!1)),(r=i.createNextLabel()).append(a),t(e).append(r),a.on("click",function(){var e=n.oJua.getEvent("onDialog");e&&e()}).on("change",function(){i.getDataFromInput(this,function(t){n.oJua.addNewFile(t),n.generateNewInput(e),setTimeout(function(){r.remove()},10)},i.getValue(n.oOptions,"multipleSizeLimit",o.iDefLimit),n.oJua.getEvent("onLimitReached"))}))},r.prototype.cancel=function(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}this.oXhrs[e]=null}},e.exports=r}()},function(e,t,n){!function(){"use strict";var t=n(1),o=n(3),i=n(2),r=n(4);function a(e,t){this.oUids={},this.oForms={},this.oJua=e,this.oOptions=t}a.prototype.oUids={},a.prototype.oForms={},a.prototype.oJua=null,a.prototype.oOptions={},a.prototype.isDragAndDropSupported=function(){return!1},a.prototype.regTaskUid=function(e){this.oUids[e]=!0},a.prototype.uploadTask=function(e,n,i){if(!1===this.oUids[e])return i(null,e),!1;var a=this.oForms[e],l=r.getValue(this.oOptions,"hidden",{}),u=this.oJua.getEvent("onStart"),s=this.oJua.getEvent("onComplete");return a?(a.append(o('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),o.each(l,function(e,t){a.append(o('<input type="hidden" />').attr("name",e).val(r.getStringOrCallFunction(t,[n])))}),a.trigger("submit"),u&&u(e),a.find("iframe").on("load",function(){var n=!1,r=null,l={};if(s){try{r=this.contentDocument?this.contentDocument:this.contentWindow.document,l=o.parseJSON(r.body.innerHTML),n=!0}catch(e){l={}}s(e,n,l)}i(null,e),t.setTimeout(function(){a.remove()},100)})):i(null,e),!0},a.prototype.generateNewInput=function(e){var t=this,n="",a=null,l=null,u=r.getValue(this.oOptions,"action",""),s=null;e&&(n=r.getNewUid(),a=r.getNewInput(r.getValue(this.oOptions,"name","juaFile"),!r.getValue(this.oOptions,"disableMultiple",!1)),s=o('<form action="'+u+'" target="iframe-'+n+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),l=o('<iframe name="iframe-'+n+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; left: -1000px; cursor: pointer;" />').css({opacity:0}),s.append(r.createNextLabel().append(a)).append(l),o(e).append(s),this.oForms[n]=s,a.on("click",function(){var e=t.oJua.getEvent("onDialog");e&&e()}).on("change",function(){r.getDataFromInput(this,function(o){o&&(s.css({position:"absolute",top:-1e3,left:-1e3}),t.oJua.addFile(n,o),t.generateNewInput(e))},r.getValue(t.oOptions,"multipleSizeLimit",i.iDefLimit),t.oJua.getEvent("onLimitReached"))}))},a.prototype.cancel=function(e){this.oUids[e]=!1,this.oForms[e]&&(this.oForms[e].remove(),this.oForms[e]=!1)},e.exports=a}()},function(e,t,n){!function(){"use strict";var t=n(4),o=n(2);function i(e){e=t.isUndefined(e)?{}:e;var i=this,r=null,a=n(1),l=n(3),u=n(8);i.bEnableDnD=!0,i.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:null},i.oOptions=t.extend({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,multipleSizeLimit:50},e),i.oQueue=u(t.pInt(t.getValue(i.oOptions,"queueSize",10))),i.runEvent("onCompleteAll")&&i.oQueue.await(function(){i.runEvent("onCompleteAll")}),r=t.getValue(i.oOptions,"disableAjaxUpload",!1)?n(6):n(5),i.oDriver=new r(i,i.oOptions),i.oClickElement=t.getValue(i.oOptions,"clickElement",null),i.oClickElement&&(l(i.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===l(this.oClickElement).css("display")&&l(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&t.getValue(this.oOptions,"dragAndDropElement",!1)&&!t.getValue(this.oOptions,"disableAjaxUpload",!1)?function(e){var n=l(a.document),i=l(t.getValue(e.oOptions,"dragAndDropBodyElement",!1)||n),r=t.getValue(e.oOptions,"dragAndDropElement",!1);r&&(t.getValue(e.oOptions,"disableDocumentDropPrevent",!1)||n.on("dragover",function(n){if(e.bEnableDnD&&n&&(n=t.getEvent(n))&&n.dataTransfer&&t.eventContainsFiles(n))try{n.dataTransfer.dropEffect="none",n.preventDefault()}catch(e){}}),i&&i[0]&&i.on("dragover",function(n){e.bEnableDnD&&n&&t.mainClearTimeout(e.iDocTimer)}).on("dragenter",function(n){e.bEnableDnD&&n&&(n=t.getEvent(n))&&t.eventContainsFiles(n)&&(t.mainClearTimeout(e.iDocTimer),n.preventDefault(),e.runEvent("onBodyDragEnter",[n]))}).on("dragleave",function(n){e.bEnableDnD&&n&&(n=t.getEvent(n))&&(t.mainClearTimeout(e.iDocTimer),e.iDocTimer=setTimeout(function(){e.runEvent("onBodyDragLeave",[n])},200))}).on("drop",function(n){if(e.bEnableDnD&&n&&(n=t.getEvent(n))){var o=t.eventContainsFiles(n);return o&&n.preventDefault(),e.runEvent("onBodyDragLeave",[n]),!o}return!1}),l(r).bind("dragenter",function(n){e.bEnableDnD&&n&&(n=t.getEvent(n))&&t.eventContainsFiles(n)&&(t.mainClearTimeout(e.iDocTimer),n.preventDefault(),e.runEvent("onDragEnter",[r,n]))}).bind("dragover",function(n){if(e.bEnableDnD&&n&&(n=t.getEvent(n))&&n.dataTransfer&&t.eventContainsFiles(n))try{var o=n.dataTransfer.effectAllowed;t.mainClearTimeout(e.iDocTimer),n.dataTransfer.dropEffect="move"===o||"linkMove"===o?"move":"copy",n.stopPropagation(),n.preventDefault(),i.trigger("dragover",n)}catch(e){}}).bind("dragleave",function(n){if(e.bEnableDnD&&n&&(n=t.getEvent(n))){var o=a.document.elementFromPoint?a.document.elementFromPoint(n.clientX,n.clientY):null;if(o&&t.contains(this,o))return;t.mainClearTimeout(e.iDocTimer),e.runEvent("onDragLeave",[r,n])}}).bind("drop",function(n){e.bEnableDnD&&n&&(n=t.getEvent(n))&&t.eventContainsFiles(n)&&(n.preventDefault(),t.getDataFromDragEvent(n,function(o){o&&(e.runEvent("onDrop",[o,n]),e.addNewFile(o),t.mainClearTimeout(e.iDocTimer))},t.getValue(e.oOptions,"multipleSizeLimit",o.iDefLimit),e.getEvent("onLimitReached"))),e.runEvent("onDragLeave",[n])}))}(i):i.bEnableDnD=!1,t.setValue(i,"on",i.on),t.setValue(i,"cancel",i.cancel),t.setValue(i,"isDragAndDropSupported",i.isDragAndDropSupported),t.setValue(i,"setDragAndDropEnabledStatus",i.setDragAndDropEnabledStatus)}i.prototype.bEnableDnD=!0,i.prototype.iDocTimer=0,i.prototype.oOptions={},i.prototype.oEvents={},i.prototype.oQueue=null,i.prototype.oDriver=null,i.prototype.on=function(e,t){return this.oEvents[e]=t,this},i.prototype.runEvent=function(e,t){this.oEvents[e]&&this.oEvents[e].apply(null,t||[])},i.prototype.getEvent=function(e){return this.oEvents[e]||null},i.prototype.cancel=function(e){this.oDriver.cancel(e)},i.prototype.setDragAndDropEnabledStatus=function(e){this.bEnableDnD=!!e},i.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},i.prototype.addNewFile=function(e){this.addFile(t.getNewUid(),e)},i.prototype.addFile=function(e,n){var o=this.getEvent("onSelect");!n||o&&!1===o(e,n)?this.oDriver.cancel(e):(this.oDriver.regTaskUid(e),this.oQueue.defer(t.scopeBind(this.oDriver.uploadTask,this.oDriver),e,n))},e.exports=i}()},function(e,t,n){e.exports=queue}]);
